<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <title>YTUExpress - Brands Page</title>
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
        <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
        <style>
        .table-hover {
            cursor: default;
        }

        .table-hover tbody tr {
            cursor: pointer;
        }
        body.modal-open #wrapper{
            -webkit-filter: blur(1px);
            -moz-filter: blur(1px);
            -o-filter: blur(1px);
            -ms-filter: blur(1px);
            filter: blur(5px);
        }
        .nav-item a{
            color:#d4daeb !important;
            font-size: large;
        }
        .nav-item a.active{
            color: #fff !important;
        }
        
        .nav-item .dropdown-menu a{
            color: #555 !important;
        }
        
        .navbar {
            background: rgb(78,115,223);
            background: -moz-linear-gradient(159deg, rgba(78,115,223,1) 0%, rgba(99,126,207,1) 100%);
            background: -webkit-linear-gradient(159deg, rgba(78,115,223,1) 0%, rgba(99,126,207,1) 100%);
            background: linear-gradient(159deg, rgba(78,115,223,1) 0%, rgba(99,126,207,1) 100%);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#4e73df",endColorstr="#637ecf",GradientType=1);
        }
        </style>
    </head>
    <body id="page-top">
        <div style="
  position: fixed;
  display: flex;
    width: 100%;
    height:100%;
    background:white;
    z-index:5000;" id="loadingScreen">
            <div class="spinner-border text-primary" style="margin: auto;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <div id="wrapper">
            <div class="wrapper"></div>
            <div class="d-flex flex-column" id="content-wrapper">
                <div id="content">
                    <nav class="navbar navbar-light navbar-expand-md" style="padding-top: 10px;padding-bottom: 10px;margin-bottom: 20px;background: linear-gradient(to right, #4e73df, #637ecf);">
                        <div class="container-fluid">
                            <a class="navbar-brand" href="brands.html" style="color: #FFFF00;">
                            <img src="assets/img/hadoop2.png" class="mr-2"  height="50" alt="">YTUExpress</a>
                            <button data-toggle="collapse" class="navbar-toggler" data-target="#navcol-1">
                                <span class="sr-only">
                                    Toggle
                                navigation
                                </span>
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            <div class="collapse navbar-collapse" id="navcol-1">
                                <ul class="nav navbar-nav">
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link active" href="brands.html">Brands</a>
                                    </li>
                                    <li class="nav-item dropdown">
                                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                         Functions
                                        </a>
                                        <div class="dropdown-menu" style="width: 200px;"  aria-labelledby="navbarDropdownMenuLink">
                                        <a class="dropdown-item" href="functions.html?name=average">Average</a>
                                        <a class="dropdown-item" href="functions.html?name=count">Count</a>
                                        <a class="dropdown-item" href="functions.html?name=median">Median</a>
                                        <a class="dropdown-item" href="functions.html?name=minmax">Min Max</a>
                                        <a class="dropdown-item" href="functions.html?name=stdev">Standart Deviation</a>
                                        </div>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link" href="about.html">About</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </nav>
                    <div class="container-fluid">
                        <h3 class="text-dark mb-4" style="font-size: 24pt;">All Brands <hr></h3>
                        <div class="row">

                        </div>
                        <div class="row mb-3">
                            <div class="col-lg-8 col-lg-12">
                                <div class="row">
                                    <div class="col col-12 mb-3">
                                        <div class="card shadow">
                                            <div class="card-header py-3" style="font-size: 16pt !important;">
                                                <div class="row">
                                                    <div class="col">
                                                        <p class="text-primary m-0 font-weight-bold">Average Prices Of Brands</p>
                                                    </div>
                                                    <div class="col">
                                                        <div class="btn-toolbar float-right">
                                                            <div class="col col-12">
                                                                <button class="btn btn-primary" id="findMinMax" type="button">Calculate Average</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <hr>
                                                <div
                                                    class="col col-11 ml-1"
                                                    id="canvasDiv"
                                                    role="grid"
                                                    aria-describedby="dataTable_info"
                
                                                >
                                                </div>
                                                <div class="col-md-12" id="loadingGraph" style="display: none;">
                                                    <div class="progressGraph">
                                                        <div
                                                            class="progress-bar progress-bar-striped progress-bar-animated"
                                                            role="progressbar"
                                                            style="width: 100%"
                                                            aria-valuenow="100"
                                                            aria-valuemin="0"
                                                            aria-valuemax="100"
                                                        ></div>
                                                    </div>
                                                    <button class="btn btn-success float-right mb-4" id="btnContinue" hidden>Continue <i class="fas fa-arrow-right"></i></button>
                                                    <br>
                                                </div>
                                                <div class="row">
                                                    <div class=" col-11 ml-1">
                                                        <p
                                                            id="numBrands"
                                                            role="status"
                                                            aria-live="polite"
                                                        ></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col col-12">
                                        <div class="card shadow">
                                            <div class="card-header py-3" style="font-size: 16pt !important;">
                                                <div class="row mb-4">
                                                    <div class="col">
                                                        <p class="text-primary m-0 font-weight-bold">Brand List</p>
                                                    </div>
                                                    <div class="col">
                                                        <div class="btn-toolbar float-right">
                                                            <div class="col-md-6">
                                                                <button class="btn btn-primary" id="findMinMax" type="button">Min Max</button>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <button class="btn btn-primary" id="calcDeviation" type="button">Deviation</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div
                                                    class="table-responsive table mt-2"
                                                    id="dataTable"
                                                    role="grid"
                                                    aria-describedby="dataTable_info"
                                                >
                                                    <table class="table table-hover dataTable my-0" id="dataTable">
                                                        <thead>
                                                            <tr>
                                                                <th>BrandName</th>
                                                                <th>Min Pricing Product</th>
                                                                <th>Max Pricing Product</th>
                                                                <th>Median Price</th>
                                                                <th>Standart Deviation</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="brandsBody">
                                                        </tbody>
                                                        <tfoot>
                                                            <tr></tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                                <div class="col-md-12" id="loadingBar" style="display: none;">
                                                    <div class="progress">
                                                        <div
                                                            class="progress-bar progress-bar-striped progress-bar-animated"
                                                            role="progressbar"
                                                            style="width: 100%"
                                                            aria-valuenow="100"
                                                            aria-valuemin="0"
                                                            aria-valuemax="100"
                                                        ></div>
                                                    </div>
                                                    <button class="btn btn-success float-right mb-4" id="btnContinue" hidden>Continue <i class="fas fa-arrow-right"></i></button>
                                                    <br>
                                                </div>
                                                <div class="row" id="footy">
                                                    <div class="col-md-6 align-self-center">
                                                        <p
                                                            id="dataTable_info"
                                                            class="dataTables_info"
                                                            role="status"
                                                            aria-live="polite"
                                                        >Showing 0 to 0</p>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <nav class="d-lg-flex justify-content-lg-end dataTables_paginate paging_simple_numbers">
                                                            <ul class="pagination" id="ul-pagination">
                                                            </ul>
                                                        </nav>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <footer class="bg-white sticky-footer">
                    <div class="container my-auto">
                        <div class="text-center my-auto copyright">
                            <span style="font-size: 16pt;">
                                Designed And Developed By Ömer Aytekin
                            And Caner Kaya
                            </span>
                        </div>
                    </div>
                </footer>
            </div>
            <a class="border rounded d-inline scroll-to-top" href="#page-top">
                <i class="fas fa-angle-up"></i>
            </a>
        </div>

        <!---------------------->
        <!-- Modal -->
        <div
            class="modal fade mb-2"
            id="myModal"
            tabindex="-1"
            data-backdrop="static"
            data-keyboard="false"
            role="dialog"
            aria-labelledby="myModalLabel"
        >
            <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title text-danger" id="myModalLabel">ERROR <i class="fa fa-exclamation-triangle"></i></h4>
                    </div>
                    <div class="modal-body">
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            onclick="window.location.href='brands.html'"
                            style="color: #fff;"
                            class="btn btn-success"
                        >Continue
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!---------------------->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/js/chart.min.js"></script>
        <script src="assets/js/bs-charts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js"></script>
        <script src="assets/js/theme.js"></script>
        <script>
        host = "http://ec2-52-3-233-164.compute-1.amazonaws.com:2626/";
        $("#loadingScreen").attr("style", "display:none");
        
        function initTable(){
            $.ajax({
                url: host + "get-brands",
                success: function(data){
                    if(data == null)
                        window.location = "brands.html"
                    else{
                        numPages = data.brandCount / 10;
                        changeTable(data, 1)
                        createPagination(numPages)
                        avgData = data.average
                        
                        $(".page-nums").click(function(){
                            $("#loadingBar").removeAttr("style");
                            $("#loadingBar").removeAttr("hidden");
                            $("#dataTable thead").attr("hidden","");
                            $("#footy").attr("hidden","");
                            $("#brandsBody").html("<h3 style='margin-left:10px;'>Waiting Data...</h3>");

                            pageNo = $(this).html();
                            nextPrev(pageNo, data.brandCount)
                            $.ajax({
                                url: host + "get-brands/"+pageNo,
                                success: function(data){
                                    $("#loadingBar").attr("hidden","");
                                    $("#dataTable thead").removeAttr("hidden");
                                    $("#footy").removeAttr("hidden");
                                    if(data){
                                        changeTable(data, pageNo);
                                        changePagination(parseInt(pageNo) + 1);
                                    } else {
                                        $("#brandsBody").html("<h2>No Data Found</h2>");
                                    }
                                }
                            });
                        });  

                        $(".next,.prev").click(function(){
                            $("#loadingBar").removeAttr("style");
                            $("#dataTable thead").attr("hidden","");
                            $("#loadingBar").removeAttr("hidden");
                            $("#footy").attr("hidden","");
                            $("#brandsBody").html("<h3 style='margin-left:10px;'>Waiting Data...</h3>");
                            if($(this).hasClass('next'))
                                pageNo = parseInt($(this).parent().attr("active")) + 1;
                            else
                                pageNo = parseInt($(this).parent().attr("active")) - 1;
    
                            $.ajax({
                                url: host + "get-brands/"+pageNo,
                                success: function(data){
                                    $("#loadingBar").attr("hidden","");
                                    $("#dataTable thead").removeAttr("hidden");
                                    $("#footy").removeAttr("hidden");
                                    if(data){
                                        changeTable(data, pageNo);
                                        changePagination(pageNo+1);
                                        nextPrev(pageNo, data.brandCount)
                                    }else {
                                        $("#brandsBody").html("<h2>No Data Found</h2>");
                                    }
                                }
                            });
                        });  
                    }
                    $("#loadingScreen").attr("style", "display:none");

                    if(avgData != null){
                        $("#canvasDiv").html("<canvas id=\"myChart\"></canvas>");
                        $("#numBrands").html("Plotting " + avgData[0].length + " brands.")
                        var ctx = document.getElementById("myChart");
                        ctx.height = 120;
                        Chart.defaults.global.legend.display = false;
                        var myChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: avgData[0],
                                datasets: [{
                                    barPercentage: 0.5,
                                    barThickness: 6,
                                    maxBarThickness: 8,
                                    minBarLength: 2,
                                    data: avgData[1],
                                    lineTension: 0.3,    
                                    fill:false,
                                    borderColor: "#4e73df",
                                    backgroundColor: "#4e73df",//version >2 useus background color
                                    hoverBackgroundColor: "#0041ff"
                                }]
                            },
                            options: {
                                scales: {
                                    yAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Average Prices',
                                            fontSize: 16, 
                                        },
                                        ticks: {
                                            beginAtZero: true,
                                            fontSize: 15,                                        
                                            callback: function(value, index, values) {
                                                // for a value (tick) equals to 8
                                                return value;
                                                // 'junior-dev' will be returned instead and displayed on your chart
                                            }
                                        },
                                        type: "logarithmic", 
                                    }],
                                    xAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Brand Names',
                                            fontSize: 16,  
                                        },
                                        ticks: {
                                            fontSize: 16,   
                                        },
                                        gridLines: {
                                            color: "rgba(0, 0, 0, 0)",
                                        }   
                                    }]
                                },
                            }
                        });                        
                    } else {
                        $("#canvasDiv").html("<h5 class='text-warning'>Average Pricing Values Not Calculated Yet!</h5>");
                    }

                },
                error: function(jqXHR, exception){
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Connection couldn\'t established.';
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found.';
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error.';
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                    } else {
                        msg = 'Uncaught Error: \n' + jqXHR.responseText;
                    }
                    console.log(msg);
                    $(".modal").modal('show');
                    $(".modal-body").html(msg);
                    $("#loadingScreen").attr("style", "display:none");
                    $(".modal-footer button").html('Refresh Page \
                    <i class="fas fa-redo-alt"></i>');
                    $(".modal-footer button").removeClass('btn-success').addClass('btn-info');
                }
              });
        }

        $(document).ready(initTable);
          
        function changeTable(data, active){
            html = "";
            data.brands.forEach(function(brand){
                html = html + "<tr class='clickable-row' data-href='brand.html?brand=" + brand[0] + "'>";
                html = html + "<td>" + brand[0] + "</td>" // Brand Name
                minPrice = (brand[1] == null || brand[2] == null) ? "Not Calculated Yet":  brand[1] + "(" + brand[2] + "₺)" 
                html = html + "<td>" + minPrice + "</td>" // Brand Name
                maxPrice = (brand[3] == null || brand[4] == null) ? "Not Calculated Yet":  brand[3] + "(" + brand[4] + "₺)" 
                html = html + "<td>" + maxPrice + "</td>" // Brand Name
                median = brand[5] == null ? "Not Calculated Yet": brand[5] 
                html = html + "<td>" + median + " ₺</td>" // Brand Name 
                stdDev = brand[6] == null ? "Not Calculated Yet": parseFloat(brand[6]).toPrecision(6);
                html = html + "<td>" + stdDev + "</td>" // Brand Name 
                html = html + "</tr>"
            });
            $("#brandsBody").html(html);
            $(".clickable-row").click(function () {
                window.location = $(this).data("href");
            });

            // Info bar changed
            showingFrom = (active-1)*10+1;
            showingTo = showingFrom + data.brands.length - 1;
            totalNum = data.brandCount + 1;
            $("#dataTable_info").html("Showing "+ showingFrom +"-" + showingTo + " of " + totalNum + " brands");


        }

        function createPagination(numPages){
        html = '<li class="page-item disabled">';
        html = html + '<a class="page-link prev" href="#" aria-label="Previous">';
        html = html + '<span aria-hidden="true">«</span>';
        html = html + '</a>';
        html = html + '</li>';
        for(i=0;i<numPages;i++){
            isactive = i==0?"active":""
            html = html + '<li class="page-item '+ isactive + '"> \
                <a class="page-link page-nums" href="#">'+ (i+1) +'</a> \
                </li>';
        }
        html = html + '<li class="page-item" active="1">';
        html = html + '<a class="page-link next" href="#" aria-label="Next">';
        html = html + '<span aria-hidden="true">»</span>';
        html = html + '</a>';
        html = html + '</li>';
        $("#ul-pagination").html(html);
        }

        function changePagination(page){
        $(".page-item").removeClass("active");
        $(".pagination .page-item:nth-child("+page+")" ).addClass("active")
        }

        function nextPrev(currentPage, numPage){
        $(".prev, .next").parent().attr("active",currentPage);
        console.log("c,n: "+currentPage+"-"+ numPage )
        if(currentPage > Math.floor(numPage/10)){
        $(".next").parent().addClass("disabled","");
        $(".prev").parent().removeClass("disabled");
        } else if (currentPage == 1) {
        $(".prev").parent().addClass("disabled","");
        $(".next").parent().removeClass("disabled");
        } else {
        $(".prev").parent().removeClass("disabled");
        $(".next").parent().removeClass("disabled");
        }
        }

        $("#findMinMax").click(function () {
            $("#brandsBody").html("Calculating...");
            $("#loadingBar").removeAttr("style");
            $("#dataTable thead").attr("hidden","");
            $("#footy").attr("hidden","");
            $.ajax({
                url: host + "start/minmax",
                success: function(data){
                    console.log("data");
                    console.log(data);
                    $("#brandsBody").html("<h2>Results</h2><hr>"+data);
                    $("#loadingBar button").removeAttr("hidden");
                    $("#loadingBar .progress").attr("hidden","");
                }
            });
        });
        $("#calcDeviation").click(function () {
            $("#brandsBody").html("Calculating...");
            $("#loadingBar").removeAttr("style");
            $("#dataTable thead").attr("hidden","");
            $("#footy").attr("hidden","");
            $.ajax({
                url: host + "start/stdev",
                success: function(data){
                    console.log("data");
                    console.log(data);
                    $("#brandsBody").html("<h2>Results</h2><hr>"+data);
                    $("#loadingBar button").removeAttr("hidden");
                    $("#loadingBar .progress").attr("hidden","");
                }
            });
        });
        $("#btnContinue").click(function(){
            $("#dataTable thead").removeAttr("hidden");
            initTable();
            $("#loadingBar button").attr("hidden","");
            $("#loadingBar").attr("style", "display:none");
            $("#footy").removeAttr("hidden");
        });


            </script>
    </body>
</html>
